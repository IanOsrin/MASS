<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MASS ‚Äî Albums & Tracks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#0f0f12; --fg:#f5f6f7; --muted:#a7abb3; --card:#17181c; --accent:#62f5a9; --border:#24262c;
      --cover-size: 80px; /* compact cover for random songs */
      --overlay: rgba(0,0,0,.6);
      --btn-gradient-start:#3a7bd5;
      --btn-gradient-end:#00d2ff;
      --btn-text:#06121f;
      --btn-shadow:rgba(58,123,213,0.25);
      --btn-shadow-hover:rgba(58,123,213,0.35);
        }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
    header{padding:12px 18px;border-bottom:1px solid var(--border);position:sticky;top:0;background:linear-gradient(180deg,rgba(15,15,18,0.98),rgba(15,15,18,0.9));backdrop-filter:saturate(180%) blur(8px);z-index:10;}
    .header-main{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:18px;justify-content:space-between;flex-wrap:wrap;}
    .header-logo{flex-shrink:0;max-height:96px;filter:drop-shadow(0 6px 12px rgba(0,0,0,0.25));}
    .searchbar{flex:1;display:grid;grid-template-columns:minmax(0,1fr) repeat(7,auto);gap:8px;align-items:center;}
    .searchbar input{background:var(--card);color:var(--fg);border:1px solid var(--border);border-radius:10px;padding:12px 14px;font-size:16px;outline:none;}
    .searchbar button{border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;font-size:14px;min-width:110px;}

    main{max-width:1100px;margin:20px auto;padding:0 16px 40px;position:relative;z-index:1;}
    .layout-grid{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap;}
    .playlist-column{flex:0 0 260px;max-width:260px;width:100%;display:flex;flex-direction:column;gap:14px;position:relative;order:2;}
    .playlist-column[hidden]{display:none !important;}
    .content-column{flex:1 1 560px;min-width:260px;display:flex;flex-direction:column;gap:16px;width:100%;order:1;}

    /* Explore layout: place Featured Playlists below the albums grid */
    .content-column.exploring{
      display:flex;
      flex-direction:column;
    }
    .content-column.exploring #albums{ order: 10; }
    .content-column.exploring #publicFeaturedRow{ order: 20; }


    .public-playlists{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:10px;}
    .public-playlists .playlists-header{display:flex;align-items:center;justify-content:space-between;gap:8px;}
    .public-playlists-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:6px;}
    .public-playlist-item button{width:100%;text-align:left;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:8px 10px;color:var(--fg);font-size:14px;display:flex;align-items:center;justify-content:space-between;gap:8px;cursor:pointer;transition:background .15s ease,border-color .15s ease;}
    .public-playlist-item button:hover{background:var(--border);}
    .public-playlist-item button.active{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent);background:rgba(98,245,169,0.15);}
    .public-playlist-count{color:var(--muted);font-size:12px;}
    .public-featured-row{display:flex;align-items:flex-start;gap:18px;width:100%;margin-bottom:16px;}
    .public-featured-row > .public-playlists{flex:0 0 220px;max-width:240px;}
    .public-playlist-view{display:flex;flex-direction:column;gap:12px;border:1px solid var(--border);border-radius:14px;background:var(--card);padding:12px;flex:1;min-width:0;}
    .public-playlist-view[hidden]{display:none !important;}
    .public-playlist-header{display:flex;align-items:center;gap:8px;}
    #closePublicPlaylistBtn{padding:4px 8px;font-size:16px;min-width:auto;line-height:1;}
    .public-playlist-title{margin:0;font-size:18px;}
    .public-playlist-status{color:var(--muted);font-size:13px;}
    .public-playlist-tracks{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:6px;overflow-y:auto;max-height:none;}
    .public-playlist-tracks::-webkit-scrollbar{width:8px;}
    .public-playlist-tracks::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.15);border-radius:999px;}
    .public-playlist-track .track-name-title{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .public-playlist-track .track-name-artist{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .public-playlist-item button{justify-content:flex-start;gap:10px;}
    .public-playlist-thumb{width:34px;height:34px;border-radius:8px;background:#101215 center/cover no-repeat;flex-shrink:0;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:16px;overflow:hidden;transition:background .2s ease, color .2s ease;}
    .public-playlist-thumb.has-art{color:transparent;}
    .public-playlist-label{display:flex;flex-direction:column;align-items:flex-start;gap:2px;flex:1;min-width:0;}
    .public-playlist-name{font-weight:600;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .public-playlist-count{color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .public-playlist-hero{border-radius:16px;overflow:hidden;background:#11141a;display:flex;align-items:center;justify-content:center;padding:12px;}
    .public-playlist-hero[hidden]{display:none;}
    .public-playlist-hero img{display:block;width:60%;height:auto;max-height:240px;object-fit:contain;}
    .public-playlist-main{flex:1;display:flex;flex-direction:column;gap:12px;}
    .playlist-actions{display:flex;align-items:center;gap:6px;}
    .playlist-footer-actions{margin-top:12px;display:flex;justify-content:flex-end;}
    .playlist-footer-actions .btn{min-width:160px;}
    .shared-playlist-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px;flex-wrap:wrap;}
    .shared-playlist-actions .btn{min-width:140px;}
    .share-link-display{display:none !important;}
    @media (max-width:900px){
      .layout-grid{flex-direction:column;}
      .playlist-column{max-width:100%;order:initial;}
      .content-column{order:initial;}
      .public-playlist-view{width:100%;max-width:none;}
      .public-featured-row{flex-direction:column;}
      .public-featured-row > .public-playlists{width:100%;max-width:none;}
    }
    .albums{display:grid;grid-template-columns:repeat(4,150px);grid-template-rows:auto auto;gap:14px;scroll-margin-top:128px;justify-content:start;width:fit-content;}
    .albums.single-album{display:flex;flex-direction:column;align-items:center;gap:24px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:9px;padding:8px;display:flex;flex-direction:column;gap:4px;overflow:hidden;scroll-margin-top:128px;min-height:132px;}
    .card-buttons{margin-top:6px;display:flex;flex-direction:column;gap:3px;}
    .card .play-button{border-radius:8px;padding:3px 6px;cursor:pointer;font-weight:600;background:var(--accent);border:none;color:var(--btn-text);width:100%;font-size:10px;min-width:auto;}
    .card .play-button:hover{filter:brightness(1.1);}
    .card .btn.secondary.small{font-size:9px;padding:2px 4px;min-width:auto;}
    .card.pending-audio{opacity:0.8;}
    .card.no-audio{display:none !important;}

    /* Cover: small, centered square; never bleeds */
    .cover-wrap{position:relative;width:var(--cover-size);height:var(--cover-size);border-radius:6px;overflow:hidden;border:1px solid var(--border);background:#101215;margin:0 auto;cursor:pointer;transition:transform 0.15s ease,box-shadow 0.15s ease;}
    .cover-wrap:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(0,0,0,0.4);}
    .cover-wrap img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;}
    .albums.single-album .cover-wrap{width:260px;height:260px;margin:0 auto 16px;}

    .heading{display:flex;align-items:center;gap:2px;flex-direction:column;justify-content:center;text-align:center;width:100%;}
    .card h3{margin:0;font-size:13px;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%;}
    .card-artist{color:var(--muted);font-size:12px;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%;}
    .albums.single-album .card h3{font-size:26px;}
    .muted{color:var(--muted);font-size:11px;text-align:center;line-height:1.2;}
    .albums.single-album .muted{font-size:16px;}
    .badge{border:1px solid var(--border);border-radius:999px;padding:2px 6px;font-size:9px;color:var(--muted);}
    .badge-warning{background:rgba(255,193,7,0.15);border-color:rgba(255,193,7,0.4);color:#ffc107;}

    .btn{border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600;font-size:14px;min-width:110px;}
    .btn.small{padding:10px 14px;font-size:14px;min-width:110px;}
    .btn.icon{width:34px;min-width:34px;display:inline-flex;align-items:center;justify-content:center;}
    .btn-accent{font-weight:700;filter:brightness(1.08);}
    .btn-error{background:#b9383a;border:none;color:#fff;box-shadow:0 6px 16px rgba(185,56,58,0.35);}
    .btn-error:hover{transform:none !important;box-shadow:0 6px 12px rgba(185,56,58,0.4) !important;}
    .btn-error:disabled{opacity:0.9;box-shadow:none;}
    .btn.info-more{font-size:18px;line-height:1;padding:4px 8px;display:flex;align-items:center;justify-content:center;min-width:auto;}


    .back-row{display:flex;justify-content:center;margin-bottom:12px;}
.toolbar{display:none;}
    .pager{display:none !important;}
    .pager button{border-radius:10px;padding:10px 14px;cursor:pointer;font-size:14px;min-width:110px;}
    .count{display:none;}
    .error{background:#2b1517;border:1px solid #5a2327;color:#ffb1b8;padding:10px 12px;border-radius:10px;}

    .explore-wrap{display:flex;align-items:center;gap:12px;flex-wrap:wrap;justify-content:flex-end;min-width:220px;}
    .explore-panel{display:flex;gap:18px;flex-wrap:wrap;align-items:flex-start;justify-content:flex-end;max-width:520px;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;}
    .explore-panel[hidden]{display:none;}
    .explore-section{display:flex;flex-direction:column;gap:8px;min-width:160px;}
    .explore-section h3{margin:0;font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);}
    .explore-buttons{display:flex;flex-wrap:wrap;gap:8px;}
    .explore-buttons button{border-radius:10px;padding:10px 14px;cursor:pointer;font-size:14px;min-width:110px;}
    #explore{padding:10px 14px;border-radius:10px;font-weight:700;font-size:14px;white-space:nowrap;min-width:110px;}

    .auth-controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;}
    .auth-controls .badge{font-size:12px;}
    .auth-controls [hidden]{display:none !important;}
    .auth-form{display:flex;flex-direction:column;gap:12px;margin-top:12px;}
    .auth-form label{display:flex;flex-direction:column;gap:6px;font-size:14px;}
    .auth-form input{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px 12px;color:var(--fg);}
    .auth-switch{display:flex;align-items:center;gap:6px;margin-top:12px;font-size:13px;color:var(--muted);}
    .auth-switch button{background:none;border:none;color:var(--accent);cursor:pointer;font-weight:600;padding:0;min-width:auto;}
    .auth-switch button:disabled{opacity:.6;cursor:not-allowed;}
    #authError{margin-top:12px;}

    .playlists-panel{padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card);display:flex;flex-direction:column;gap:10px;}
    .playlists-panel[hidden]{display:none;}
    .playlists-header{display:flex;align-items:center;gap:12px;justify-content:space-between;}
    .playlists-header h2{margin:0;font-size:14px;letter-spacing:.02em;text-transform:uppercase;color:var(--muted);}
    .playlists-list{display:flex;flex-direction:column;gap:8px;}
    .playlist-pill{display:flex;flex-direction:column;align-items:flex-start;gap:2px;padding:8px 10px;border-radius:10px;border:1px solid var(--border);background:#1b1c20;color:#f5f5f5;cursor:pointer;min-width:0;transition:transform .15s ease,box-shadow .15s ease;font-size:12px;}
    .playlist-pill:hover{transform:translateY(-1px);box-shadow:0 10px 20px rgba(0,0,0,.25);}
    .playlist-pill.active{border-color:var(--accent);box-shadow:0 0 0 1px rgba(98,245,169,.4);}
    .playlist-pill .name{font-weight:600;font-size:13px;}
    .playlist-pill .meta{color:var(--muted);font-size:11px;}
    .playlist-empty{color:var(--muted);font-size:12px;}
    .playlist-create{display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
    .playlist-create input{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:8px 10px;color:var(--fg);flex:1;min-width:160px;font-size:13px;}
    .playlist-create button{padding:4px 8px;border-radius:8px;cursor:pointer;font-size:10px;min-width:auto;}
    #importPlaylistButton{padding:4px 8px;border-radius:8px;font-size:10px;min-width:auto;}
    .playlist-actions .btn.small{padding:4px 8px;border-radius:8px;font-size:10px;min-width:auto;}
    .playlist-footer-actions .btn.small{padding:4px 8px;border-radius:8px;font-size:10px;min-width:auto;}

    .playlist-tracks{padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card);display:flex;flex-direction:column;gap:6px;}
    .playlist-tracks[hidden]{display:none;}
    .playlist-tracks .playlists-header{margin-bottom:0;}
    .playlist-tracks .playlists-header h2{font-size:18px;}
    .playlist-tracks .muted{font-size:13px;}
    .playlist-tracks .tracks{display:flex;flex-direction:column;gap:6px;margin:0;padding:0;list-style:none;max-height:360px;overflow-y:auto;}
    .playlist-track{display:flex;align-items:center;gap:10px;padding:6px 10px;border-radius:6px;background:transparent;border:1px solid transparent;min-height:36px;}
    .playlist-track:hover{background:#1c1d21;border-color:rgba(255,255,255,0.07);}
    .playlist-track.playing{background:#202427;border-color:var(--accent);}
    .playlist-track .track-name{flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:14px;font-weight:600;line-height:1.4;margin:0;}
    .playlist-track .track-play{width:26px;height:26px;border-radius:4px;padding:0;font-size:12px;font-weight:600;display:inline-flex;align-items:center;justify-content:center;line-height:1;min-width:26px;}
    .playlist-tracks.collapsed .tracks{display:none;}
    .playlist-tracks.collapsed .playlist-empty{display:none;}
    .playlist-tracks.only-current .tracks{display:none;}
    .playlist-tracks.only-current .playlist-empty{display:none;}
    .playlist-tracks.only-current .now-playing-placeholder{display:none;}

    .now-playing{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card);display:flex;flex-direction:column;gap:6px;box-sizing:border-box;}
    .now-playing[hidden]{display:none !important;}
    .now-playing-header{display:flex;align-items:center;justify-content:space-between;gap:4px;}
    .now-playing-header .label{font-size:9px;font-weight:600;letter-spacing:.06em;text-transform:uppercase;color:var(--muted);}
    .now-playing-body{display:flex;align-items:center;gap:6px;}
    .now-playing-thumb{width:28px;height:28px;border-radius:5px;overflow:hidden;flex-shrink:0;background:#0e1014;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:8px;color:var(--muted);}
    .now-playing-thumb img{width:100%;height:100%;object-fit:cover;display:block;}
    .now-playing-meta{display:flex;flex-direction:column;gap:1px;min-width:0;}
    .now-playing-title{font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .now-playing-sub{font-size:9.5px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .now-playing-source{font-size:9px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .now-playing-controls{display:flex;align-items:center;gap:4px;flex-wrap:wrap;}
    .now-playing-meta-buttons{display:flex;flex-wrap:wrap;gap:3px;}
    .now-playing-meta-buttons .btn.small{padding:3px 5px;font-size:9px;min-width:auto;}
    .now-playing-meta-list{display:flex;flex-direction:column;gap:2px;font-size:9px;}
    .now-playing-meta-line{color:var(--muted);}
    .now-playing-meta-line strong{color:var(--fg);font-weight:600;}
    .now-playing-status{font-size:9px;color:var(--muted);}
    .now-playing-progress{width:100%;height:2px;background:#262830;border-radius:2px;overflow:hidden;position:relative;margin-top:3px;}
    .now-playing-progress .fill{position:absolute;inset:0;background:linear-gradient(90deg,var(--accent),#6bd3ff);width:0%;border-radius:2px;transition:width .1s linear;}
    .now-playing-controls .btn.small{padding:3px 6px;font-size:10px;min-width:auto;}
    #nowPlayingCollapse{padding:2px 4px;font-size:8px;min-width:auto;}
    .now-playing.collapsed .now-playing-body,
    .now-playing.collapsed .now-playing-controls{display:none;}

    /* Landing placeholder */
    .loading-indicator{display:flex;flex-direction:column;align-items:center;justify-content:center;position:fixed;inset:0;z-index:50;background:var(--bg);}
    .loading-indicator[hidden]{display:none;}
    .loading-background{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0.85;filter:brightness(1.1) contrast(1.15);}
    .loading-spinner{width:80px;height:80px;border:6px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;position:relative;z-index:2;box-shadow:0 8px 24px rgba(98,245,169,0.3);}
    @keyframes spin{to{transform:rotate(360deg);}}
    .loading-text{color:var(--fg);font-size:18px;font-weight:700;margin-top:24px;position:relative;z-index:2;text-shadow:0 2px 8px rgba(0,0,0,0.5);letter-spacing:0.5px;}

    /* Placeholder images - bold and dominant style */
    img.placeholder-image, img[src*="placeholder.png"]{opacity:0.85 !important;filter:brightness(1.1) contrast(1.15) !important;}

    /* ======= Modal (centered track window) ======= */
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--overlay);z-index:100;}
    .overlay.open{display:flex;}
    .modal{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.35);width:min(450px,47vw);max-height:44vh;display:flex;flex-direction:column;overflow:hidden;}
    .modal header{display:flex;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid var(--border);background:#14161a;position:sticky;top:0;z-index:1;}
    .modal .cover-wrap{width:56px;height:56px;margin:0;}
    .modal .meta{display:flex;flex-direction:column;gap:2px;min-width:0;}
    .modal h2{margin:0;font-size:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .modal .sub{color:var(--muted);font-size:13px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .modal .spacer{flex:1;}
    .modal .close{border-radius:10px;padding:8px 10px;cursor:pointer;min-width:auto;}
    .modal .content{padding:12px;overflow:auto;}
    .album-actions{display:flex;justify-content:flex-end;gap:10px;margin:0 0 12px;}
    .album-actions .btn{white-space:nowrap;}
    .tracks{margin:0;padding:0;list-style:none;display:flex;flex-direction:column;gap:8px;}
    .track{background:#1f1f23;padding:8px 10px;border-radius:8px;display:flex;flex-direction:column;gap:6px;}
    .track.loading{opacity:0.75;}
    .track.loading .btn.small{pointer-events:none;}
    .track-top{display:flex;align-items:center;justify-content:space-between;gap:10px;}
    .track-title{display:flex;flex-direction:column;flex:1;min-width:0;}
    .track .name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .track .artist{color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .controls{display:flex;align-items:center;gap:6px;}
    .playing{outline:1px solid var(--accent); background:#202427; font-weight:bold; opacity:1;}
    .progress{display:flex;align-items:center;gap:8px;margin-top:6px;}
    .seek{appearance:none;width:240px;height:8px;background:linear-gradient(var(--accent),var(--accent)) 0/var(--fill,0%) 100% no-repeat,#1b2a21;border-radius:999px;outline:none;border:1px solid var(--accent);}
    .seek::-webkit-slider-thumb{appearance:none;width:12px;height:12px;border-radius:50%;background:var(--accent);}
    .time{font-size:12px;color:var(--muted);min-width:98px;text-align:right;}
    .no-scroll{overflow:hidden;}

    .info-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:150;}
    .info-modal-overlay.open{display:flex;}
    .info-modal{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px 20px;width:min(480px,92vw);max-height:80vh;overflow:auto;box-shadow:0 18px 48px rgba(0,0,0,.4);}
    .info-modal header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:12px;}
    .info-modal h3{margin:0;font-size:18px;}
    .info-modal .info-close{border-radius:8px;padding:6px 10px;cursor:pointer;min-width:auto;}

    .share-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:150;}
    .share-modal-overlay.open{display:flex;}
    .share-modal{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;width:min(520px,92vw);box-shadow:0 18px 48px rgba(0,0,0,.4);}
    .share-modal h3{margin:0 0 8px;font-size:18px;}
    .share-modal p{margin:0 0 16px;color:var(--muted);font-size:14px;}
    .share-modal input{width:100%;background:var(--bg);color:var(--fg);border:1px solid var(--border);border-radius:8px;padding:12px;font-size:14px;font-family:monospace;margin-bottom:16px;}
    .share-modal input:focus{outline:2px solid var(--accent);outline-offset:2px;}
    .share-modal .actions{display:flex;gap:10px;justify-content:flex-end;}
    .share-modal .btn{min-width:100px;}
    .info-modal dl{margin:0;display:grid;grid-template-columns:minmax(120px,auto) 1fr;gap:10px 14px;font-size:14px;}
    .info-modal dt{font-weight:600;color:var(--muted);}
    .info-modal dd{margin:0;}
    .info-modal-empty{color:var(--muted);font-style:italic;text-align:center;margin:12px 0;}

    /* Busy / searching status indicator */
    .status{display:inline-flex;align-items:center;gap:8px;margin-left:8px;color:var(--muted);font-size:13px;}
    .status[hidden]{display:none;}
    .status .pulse{width:8px;height:8px;border-radius:50%;background:var(--accent);
      box-shadow:0 0 0 0 rgba(98,245,169,.7);animation:pulse 1.3s infinite;}
    @keyframes pulse{
      0%{transform:scale(.9);box-shadow:0 0 0 0 rgba(98,245,169,.7);}
      70%{transform:scale(1);box-shadow:0 0 0 10px rgba(98,245,169,0);}
      100%{transform:scale(.9);box-shadow:0 0 0 0 rgba(98,245,169,0);}
        }
    .btn,
    .searchbar button,
    .pager button,
    .explore-buttons button,
    .modal .close,
    .info-modal .info-close,
    #explore {
      background:linear-gradient(135deg,var(--btn-gradient-start),var(--btn-gradient-end));
      color:var(--btn-text);
      border:none;
      box-shadow:0 6px 18px var(--btn-shadow);
      transition:transform 0.15s ease,box-shadow 0.15s ease,opacity 0.15s ease;
    }

    .btn:hover,
    .searchbar button:hover,
    .pager button:hover,
    .explore-buttons button:hover,
    .modal .close:hover,
    .info-modal .info-close:hover,
    #explore:hover {
      transform:translateY(-1px);
      box-shadow:0 8px 20px var(--btn-shadow-hover);
    }

    .btn:active,
    .searchbar button:active,
    .pager button:active,
    .explore-buttons button:active,
    .modal .close:active,
    .info-modal .info-close:active,
    #explore:active {
      transform:translateY(0);
      box-shadow:0 5px 14px var(--btn-shadow);
    }

    button:disabled{opacity:.6;cursor:not-allowed;transform:none !important;box-shadow:none !important;}

    /* Fix playlist row layout: keep items in a row next to the play button */
    .track.playlist-track {
      flex-direction: row;       /* override .track { flex-direction: column } */
      align-items: center;
      gap: 0.5rem;               /* keep a little space between button and text */
    }

    /* Ensure the text can shrink and ellipsis correctly in a flex row */
    .playlist-track .track-name {
      flex: 1;
      min-width: 0;              /* required so text-overflow works inside flex */
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .playlist-track .track-name-artist {
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .playlist-track .track-name-title {
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

  </style>
</head>
<body>
  <header>
    <div class="header-main">
      <img src="/img/MAD_Logo.png" alt="MAD Logo" class="header-logo">
      <div class="searchbar">
        <input id="search" type="search" placeholder="Search albums, artists, tracks, year, genre‚Ä¶" autocomplete="off" />
        <button id="go">Search</button>
        <button id="clear">Clear</button>
        <button id="shuffleBtn" class="btn-accent" hidden>üîÑ Load More</button>
        <button id="shufflePlayBtn" class="btn-accent" hidden aria-pressed="false">‚ñ∂ Shuffle Play</button>
        <button id="randomSkipBtn" class="btn small" hidden type="button">‚è≠ Skip</button>
        <span id="status" class="status" hidden aria-live="polite" role="status"><span class="pulse"></span><span id="statusText">Searching‚Ä¶</span></span>
      </div>
      <div class="explore-wrap">
        <button id="explore" type="button" aria-expanded="false">Explore</button>
        <div id="explorePanel" class="explore-panel" hidden>
          <section class="explore-section">
            <h3>Decades</h3>
            <div id="exploreDecades" class="explore-buttons"></div>
          </section>
          <section class="explore-section">
            <h3>Genres</h3>
            <div id="exploreGenres" class="explore-buttons"></div>
          </section>
          <section class="explore-section">
            <h3>Moods</h3>
            <div id="exploreMoods" class="explore-buttons"></div>
          </section>
        </div>
        <div id="authControls" class="auth-controls">
          <span id="userBadge" class="badge" hidden></span>
          <button id="loginTrigger" type="button" class="btn small">Log in</button>
          <button id="signupTrigger" type="button" class="btn small">Sign up</button>
          <button id="logoutButton" type="button" class="btn small" hidden>Log out</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="layout-grid">
      <aside id="playlistColumn" class="playlist-column" hidden>
        <section id="nowPlayingCard" class="now-playing" hidden>
          <div class="now-playing-header">
            <span class="label">Now Playing</span>
            <button id="nowPlayingCollapse" type="button" class="btn small">Hide</button>
          </div>
          <div class="now-playing-body">
            <div id="nowPlayingThumb" class="now-playing-thumb">--</div>
            <div class="now-playing-meta">
              <div id="nowPlayingTitle" class="now-playing-title">Track</div>
              <div id="nowPlayingSubtitle" class="now-playing-sub">Artist</div>
              <div id="nowPlayingSource" class="now-playing-source"></div>
            </div>
          </div>
          <div class="now-playing-controls">
            <span id="nowPlayingStatus" class="now-playing-status">Paused</span>
            <div id="nowPlayingMetaButtons" class="now-playing-meta-buttons"></div>
            <button id="nowPlayingAdd" type="button" class="btn small" hidden>+ Playlist</button>
            <button id="nowPlayingToggle" type="button" class="btn small">Play</button>
          </div>
          <div class="now-playing-progress">
            <div id="nowPlayingProgressFill" class="fill"></div>
          </div>
        </section>
        <section id="playlistsPanel" class="playlists-panel" hidden>
          <div class="playlists-header">
            <h2>My Playlists</h2>
            <span id="playlistsStatus" class="muted"></span>
          </div>
          <div id="playlistsList" class="playlists-list"></div>
          <form id="playlistCreateForm" class="playlist-create" autocomplete="off">
            <input id="playlistNameInput" type="text" placeholder="Create new playlist" maxlength="80" />
            <button type="submit" class="btn small">Create</button>
          </form>
          <button id="importPlaylistButton" type="button" class="btn small" style="width:100%;margin-top:8px;">Import Playlist</button>
          <div id="playlistsEmpty" class="playlist-empty" hidden>No playlists yet. Create one to start saving tracks.</div>
        </section>
        <section id="publicPlaylistsPanel" class="public-playlists" hidden>
          <div class="playlists-header">
            <h2>Featured Playlists</h2>
          </div>
          <ul id="publicPlaylistsList" class="public-playlists-list"></ul>
          <div id="publicPlaylistsEmpty" class="playlist-empty" hidden>No curated playlists yet.</div>
        </section>
        <section id="playlistTracksSection" class="playlist-tracks" hidden>
          <div class="playlists-header">
            <h2 id="playlistTracksTitle">Playlist</h2>
            <div class="playlist-actions">
              <button id="togglePlaylistTracks" type="button" class="btn small">Show tracks</button>
              <button id="deletePlaylistButton" type="button" class="btn small btn-error">Delete playlist</button>
            </div>
          </div>
          <div id="playlistTracksMeta" class="muted"></div>
          <ul id="playlistTracksList" class="tracks"></ul>
          <div id="playlistTracksEmpty" class="playlist-empty" hidden>No tracks in this playlist yet.</div>
          <div class="playlist-footer-actions">
            <button id="exportPlaylistButton" type="button" class="btn small">Export</button>
          </div>
        </section>
      </aside>
      <section class="content-column">
        <div class="toolbar">
          <div id="count" class="count"></div>
        </div>
        <section id="publicPlaylistView" class="public-playlist-view" hidden>
          <div class="public-playlist-header">
            <h2 id="publicPlaylistTitle" class="public-playlist-title">Featured Playlist</h2>
            <span id="publicPlaylistMeta" class="public-playlist-status"></span>
            <button id="closePublicPlaylistBtn" type="button" class="btn small" style="margin-left:auto;">‚úï</button>
          </div>
          <div id="publicPlaylistStatus" class="public-playlist-status" hidden></div>
          <div id="publicPlaylistHero" class="public-playlist-hero" hidden>
            <img id="publicPlaylistArt" alt="Playlist artwork" />
          </div>
          <ul id="publicPlaylistTracks" class="tracks public-playlist-tracks"></ul>
          <div id="publicPlaylistEmpty" class="playlist-empty" hidden>No tracks in this playlist.</div>
        </section>
        <section id="sharedPlaylistView" class="public-playlist-view" hidden>
          <div class="public-playlist-header">
            <h2 id="sharedPlaylistTitle" class="public-playlist-title">Playlist</h2>
            <span id="sharedPlaylistMeta" class="public-playlist-status"></span>
          </div>
          <div id="sharedPlaylistStatus" class="public-playlist-status" hidden></div>
          <div id="sharedPlaylistHero" class="public-playlist-hero" hidden>
            <img id="sharedPlaylistArt" alt="Playlist artwork" />
          </div>
          <ul id="sharedPlaylistTracks" class="tracks public-playlist-tracks"></ul>
          <div id="sharedPlaylistEmpty" class="playlist-empty" hidden>No tracks are available in this shared playlist.</div>
          <div class="shared-playlist-actions">
            <button id="sharedPlaylistBack" type="button" class="btn small">Back to discovery</button>
            <button id="sharedPlaylistCopy" type="button" class="btn small">Copy share link</button>
          </div>
        </section>
        <div id="loadingIndicator" class="loading-indicator">
          <img src="/img/placeholder.png" alt="" class="loading-background" />
          <div class="loading-spinner"></div>
          <div class="loading-text">Loading albums...</div>
        </div>
        <div id="albums" class="albums"></div>
        <div id="pager" class="pager" hidden>
          <button id="prev">‚óÄ Prev</button>
          <span id="pageInfo" class="badge">Page 1</span>
          <button id="next">Next ‚ñ∂</button>
        </div>
        <div id="error" class="error" hidden></div>
      </section>
    </div>
  </main>

  <!-- Single centered modal (reused for all albums) -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <header>
        <div id="modalCover" class="cover-wrap" aria-hidden="true"></div>
        <div class="meta">
          <h2 id="modalTitle">Album</h2>
          <div class="sub">
            <span id="modalArtist"></span>
            <span id="modalCat" class="badge"></span>
          </div>
        </div>
        <div class="spacer"></div>
        <button id="modalClose" class="close" aria-label="Close">‚úï</button>
          </header>
      <div id="modalContent" class="content"></div>
    </div>
  </div>

  <div id="trackInfoOverlay" class="info-modal-overlay" hidden>
    <div id="trackInfoDialog" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="trackInfoTitle">
      <header>
        <h3 id="trackInfoTitle">More info</h3>
        <button type="button" id="trackInfoClose" class="info-close">Close</button>
      </header>
      <div id="trackInfoBody"></div>
    </div>
  </div>

  <div id="authOverlay" class="info-modal-overlay" hidden>
    <div id="authDialog" class="info-modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <header>
        <h3 id="authTitle">Log in</h3>
        <button type="button" id="authClose" class="info-close">Close</button>
      </header>
      <form id="authForm" class="auth-form">
        <label for="authEmail">
          <span>Email</span>
          <input id="authEmail" type="email" name="email" autocomplete="email" required />
        </label>
        <label for="authPassword">
          <span>Password</span>
          <input id="authPassword" type="password" name="password" autocomplete="current-password" minlength="8" required />
        </label>
        <button type="submit" id="authSubmit" class="btn btn-accent">Log in</button>
      </form>
      <div class="auth-switch">
        <span id="authToggleText">Need an account?</span>
        <button type="button" id="authSwitchMode">Sign up</button>
      </div>
      <div id="authError" class="error" hidden></div>
    </div>
  </div>

  <div id="shareModal" class="share-modal-overlay">
    <div class="share-modal" role="dialog" aria-modal="true" aria-labelledby="shareModalTitle">
      <h3 id="shareModalTitle">Share Playlist</h3>
      <p>Copy this link to share your playlist:</p>
      <input id="shareLinkInput" type="text" readonly />
      <div class="actions">
        <button type="button" id="shareModalClose" class="btn small">Close</button>
      </div>
    </div>
  </div>

  <div id="exportModal" class="share-modal-overlay">
    <div class="share-modal" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle">
      <h3 id="exportModalTitle">Export Playlist</h3>
      <p>Copy the compact code or download as JSON file:</p>
      <input id="exportCodeInput" type="text" readonly />
      <div class="actions">
        <button type="button" id="exportDownloadBtn" class="btn small">Download JSON</button>
        <button type="button" id="exportCopyBtn" class="btn small">Copy Code</button>
        <button type="button" id="exportModalClose" class="btn small">Close</button>
      </div>
    </div>
  </div>

  <div id="importModal" class="share-modal-overlay">
    <div class="share-modal" role="dialog" aria-modal="true" aria-labelledby="importModalTitle">
      <h3 id="importModalTitle">Import Playlist</h3>
      <p>Paste a compact code (MASS:...) or upload a JSON file:</p>
      <textarea id="importCodeInput" placeholder="Paste MASS:... code here" rows="4" style="width:100%;background:var(--bg);color:var(--fg);border:1px solid var(--border);border-radius:8px;padding:12px;font-size:14px;font-family:monospace;margin-bottom:12px;resize:vertical;"></textarea>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
        <span style="color:var(--muted);font-size:14px;">or</span>
        <input type="file" id="importFileInput" accept=".json" style="flex:1;font-size:14px;" />
      </div>
      <div id="importStatus" style="color:var(--muted);font-size:13px;margin-bottom:12px;min-height:20px;"></div>
      <div class="actions">
        <button type="button" id="importSubmitBtn" class="btn small">Import</button>
        <button type="button" id="importModalClose" class="btn small">Close</button>
      </div>
    </div>
  </div>

  <audio id="player" preload="none"></audio>

  <script>
    // Close featured playlist button handler
    document.addEventListener('DOMContentLoaded', () => {
      const closeBtn = document.getElementById('closePublicPlaylistBtn');
      const clearBtn = document.getElementById('clear');
      const publicPlaylistView = document.getElementById('publicPlaylistView');
      const searchEl = document.getElementById('search');
      if (closeBtn && clearBtn && publicPlaylistView && searchEl) {
        closeBtn.addEventListener('click', () => {
          // Hide the featured playlist view immediately
          publicPlaylistView.hidden = true;
          // Clear search and trigger clear button to load random songs
          searchEl.value = '';
          clearBtn.click();
        });
      }

      // Preload featured playlists in the background
      setTimeout(() => {
        fetch('/api/public-playlists', { headers: { 'Accept': 'application/json' } })
          .then(res => res.json())
          .then(data => {
            if (Array.isArray(data?.playlists)) {
              // Preload each featured playlist's tracks in the background
              data.playlists.forEach((playlist, index) => {
                if (playlist?.name) {
                  // Stagger the requests to avoid overwhelming the server
                  setTimeout(() => {
                    fetch(`/api/public-playlists?name=${encodeURIComponent(playlist.name)}`, {
                      headers: { 'Accept': 'application/json' }
                    }).catch(err => console.log('Preload failed for', playlist.name));
                  }, index * 500); // 500ms between each preload
                }
              });
            }
          })
          .catch(err => console.log('Failed to preload featured playlists'));
      }, 2000); // Wait 2 seconds after page load before preloading
    });
  </script>
  <script src="/app.min.js?v=14" defer></script></body>
</html>
