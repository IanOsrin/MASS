<!DOCTYPE html>
<html>
<head>
  <title>Button Test - Direct Check</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #0f0f12; color: #f5f6f7; }
    button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
    .log { background: #1a1a1a; padding: 15px; margin: 20px 0; border-radius: 8px; max-height: 400px; overflow-y: auto; }
    .log div { margin: 5px 0; }
    .error { color: #ff6b6b; }
    .success { color: #51cf66; }
    .info { color: #74c0fc; }
  </style>
</head>
<body>
  <h1>üîç Button Event Listener Test</h1>

  <h2>Step 1: Check if buttons exist in main page</h2>
  <div id="buttonCheck" class="log"></div>

  <h2>Step 2: Test event listeners</h2>
  <button id="testClear">Test Clear Button</button>
  <button id="testShuffle">Test Shuffle Button</button>
  <div id="testLog" class="log"></div>

  <h2>Step 3: Check browser console</h2>
  <p>Open your browser's DevTools (F12) and check the Console tab for:</p>
  <ul>
    <li><code>[INIT] Attaching clearEl event listener</code></li>
    <li><code>[INIT] Attaching shuffleBtn event listener</code></li>
  </ul>
  <p>If you DON'T see these messages, the JavaScript file has an error.</p>

  <h2>Step 4: API Test</h2>
  <button id="testAPI">Test /api/random-songs API</button>
  <div id="apiLog" class="log"></div>

  <script>
    const buttonCheck = document.getElementById('buttonCheck');
    const testLog = document.getElementById('testLog');
    const apiLog = document.getElementById('apiLog');

    function log(element, msg, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      element.insertBefore(div, element.firstChild);
    }

    // Check if main page buttons exist
    window.addEventListener('load', () => {
      try {
        // Try to access the main page's buttons via iframe (won't work due to CORS, but we can check)
        const mainClear = parent.document?.getElementById('clear');
        const mainShuffle = parent.document?.getElementById('shuffleBtn');

        log(buttonCheck, '‚ùå Cannot access main page buttons from test page (security restriction)', 'info');
        log(buttonCheck, '‚úì This is normal. Check the main page console instead.', 'info');
      } catch (e) {
        log(buttonCheck, '‚úì Security restriction confirmed (expected)', 'info');
      }

      log(buttonCheck, '', 'info');
      log(buttonCheck, 'üìã TO CHECK MAIN PAGE:', 'info');
      log(buttonCheck, '1. Go back to http://localhost:3000/', 'info');
      log(buttonCheck, '2. Open DevTools Console (F12)', 'info');
      log(buttonCheck, '3. Look for [INIT] messages', 'info');
      log(buttonCheck, '4. If missing, there\'s a JavaScript error', 'info');
    });

    // Test button events
    document.getElementById('testClear').addEventListener('click', () => {
      log(testLog, '‚úì Clear button click works!', 'success');
      log(testLog, 'Calling /api/random-songs...', 'info');

      fetch('/api/random-songs?count=2')
        .then(r => r.json())
        .then(data => {
          log(testLog, `‚úì Got ${data?.items?.length || 0} songs`, 'success');
        })
        .catch(err => {
          log(testLog, `‚ùå Error: ${err.message}`, 'error');
        });
    });

    document.getElementById('testShuffle').addEventListener('click', () => {
      log(testLog, '‚úì Shuffle button click works!', 'success');
    });

    document.getElementById('testAPI').addEventListener('click', async () => {
      log(apiLog, 'Testing /api/random-songs...', 'info');

      try {
        const start = performance.now();
        const response = await fetch('/api/random-songs?count=3');
        const elapsed = performance.now() - start;

        if (!response.ok) {
          log(apiLog, `‚ùå API returned ${response.status} ${response.statusText}`, 'error');
          return;
        }

        const data = await response.json();
        log(apiLog, `‚úì API success! Got ${data?.items?.length || 0} songs in ${elapsed.toFixed(0)}ms`, 'success');
        log(apiLog, `First song: ${data.items[0]?.fields?.['Track Name'] || 'Unknown'}`, 'info');
      } catch (err) {
        log(apiLog, `‚ùå Error: ${err.message}`, 'error');
      }
    });
  </script>
</body>
</html>
